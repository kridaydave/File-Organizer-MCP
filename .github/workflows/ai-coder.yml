name: AI Coder Sub-Agent

on:
  workflow_dispatch:
    inputs:
      instruction:
        description: "The feature or fix for the AI to build"
        required: true

permissions:
  contents: write
  pull-requests: write

jobs:
  ai-coder:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Run AI Coder Sub-Agent
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # You MUST set this up in your repository's Settings > Secrets and Variables > Actions
          OPENCODE_API_KEY: ${{ secrets.OPENCODE_API_KEY }} 
          INSTRUCTION: ${{ github.event.inputs.instruction }}
        run: |
          # Ensure you placed ai-coder.cjs in the scripts/ folder
          node scripts/ai-coder.cjs
